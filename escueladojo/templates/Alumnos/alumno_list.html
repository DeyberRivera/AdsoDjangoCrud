{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h1>Alumnos</h1>
  <a href="{% url 'alumnos:nuevo' %}" class="btn btn-primary mb-3">Nuevo alumno</a>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Edad</th>
        <th>Teléfono</th>
        <th>Email</th>
        <th>Cinturón</th>
        <th>Estado</th>
        <th>Fecha de Ingreso</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for alumno in alumnos %}
      <tr>
        <td>{{ alumno.nombre }}</td>
        <td>{{ alumno.edad }}</td>
        <td>{{ alumno.telefono }}</td>
        <td>{{ alumno.email }}</td>
        <td>{{ alumno.cinturon }}</td>
        <td>{{ alumno.estado }}</td>
        <td>{{ alumno.fecha_ingreso }}</td>
        <td>
          <a href="{% url 'alumnos:editar' alumno.pk %}" class="btn btn-sm btn-warning">Editar</a>
          <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-pk="{{ alumno.pk }}" data-nombre="{{ alumno.nombre }}">
            Eliminar
          </button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" class="text-center">No hay alumnos registrados</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Paginación -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {% if alumnos.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ alumnos.previous_page_number }}">&laquo; Anterior</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo; Anterior</span></li>
      {% endif %}
      {% for num in alumnos.paginator.page_range %}
        {% if alumnos.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% elif num >= alumnos.number|add:-2 and num <= alumnos.number|add:2 %}
        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}
      {% if alumnos.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ alumnos.next_page_number }}">Siguiente &raquo;</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Siguiente &raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" id="deleteForm">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteLabel">Confirmar eliminación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          ¿Estás seguro de que deseas eliminar al alumno <strong id="modalAlumnoName"></strong>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-danger">Eliminar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Script para manejar modal -->
<script>
 var deleteModal = document.getElementById('confirmDeleteModal')
 deleteModal.addEventListener('show.bs.modal', function (event) {
   var button = event.relatedTarget
   var pk = button.getAttribute('data-pk')
   var name = button.getAttribute('data-nombre')
   var form = deleteModal.querySelector('#deleteForm')
   form.action = "{% url 'alumnos:eliminar' '0' %}".replace('0', pk)
   deleteModal.querySelector('#modalAlumnoName').textContent = name
 })
</script>
{% endblock %}